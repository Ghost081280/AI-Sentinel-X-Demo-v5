<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Discovery | AI Sentinel-X</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00ff88;
            --secondary: #00ccff;
            --accent: #7c3aed;
            --danger: #ff0044;
            --warning: #ffaa00;
            --success: #00ff88;
            --bg-dark: #0a0e1a;
            --bg-darker: #060912;
            --bg-card: rgba(10, 20, 40, 0.8);
            --border: rgba(0, 255, 136, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #8892b0;
            --gradient-1: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            --gradient-2: linear-gradient(135deg, #7c3aed 0%, #00ccff 100%);
            --gradient-shield: linear-gradient(135deg, #1a4d2e 0%, #00ff88 50%, #00ccff 100%);
            --gradient-network: linear-gradient(135deg, #00ccff 0%, #0066ff 100%);
            --gradient-external: linear-gradient(135deg, #ff0044 0%, #ff6644 100%);
            --gradient-internal: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            --gradient-datacenter: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            --gradient-business: linear-gradient(135deg, #9333ea 0%, #c084fc 100%);
            --gradient-hybrid: linear-gradient(135deg, #00ff88 0%, #7c3aed 50%, #00ccff 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Consolas', 'Monaco', monospace;
            background: var(--bg-darker);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Neural Network Background Canvas */
        #neuralCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }

        /* Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px 35px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-shield {
            width: 50px;
            height: 50px;
            background: var(--gradient-shield);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            position: relative;
            animation: shieldPulse 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes shieldPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo-eye {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--bg-darker);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-iris {
            width: 20px;
            height: 20px;
            background: var(--gradient-1);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }

        .rotating-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 6px var(--primary);
        }

        .dot:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); }
        .dot:nth-child(2) { top: 50%; right: 0; transform: translateY(-50%); }
        .dot:nth-child(3) { bottom: 0; left: 50%; transform: translateX(-50%); }

        .brand-info {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 2px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        /* Scale Detection Indicator */
        .scale-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .scale-individual {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }

        .scale-business {
            background: rgba(147, 51, 234, 0.1);
            border-color: #9333ea;
            color: #9333ea;
        }

        .scale-enterprise {
            background: rgba(255, 107, 53, 0.1);
            border-color: #ff6b35;
            color: #ff6b35;
        }

        /* Encryption Status Badges */
        .encryption-badges {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .encryption-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--primary);
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .encryption-badge:hover {
            background: rgba(0, 255, 136, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .status-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
            animation: statusPulse 3s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .agent-status {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--primary);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .agent-status:hover {
            background: rgba(0, 255, 136, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.3);
        }

        .agent-icon {
            font-size: 20px;
        }

        .agent-info {
            display: flex;
            flex-direction: column;
        }

        .agent-title {
            font-weight: bold;
            font-size: 14px;
            color: var(--primary);
        }

        .agent-status-text {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .logout-btn {
            background: transparent;
            border: 1px solid rgba(255, 0, 68, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            color: var(--danger);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logout-btn:hover {
            background: rgba(255, 0, 68, 0.1);
            transform: translateY(-2px);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: var(--bg-card);
            padding: 12px;
            border-radius: 15px;
            border: 1px solid var(--border);
            overflow-x: auto;
            backdrop-filter: blur(15px);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .nav-tab:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--border);
            color: var(--primary);
        }

        .nav-tab.active {
            background: var(--gradient-1);
            color: var(--bg-darker);
            font-weight: bold;
        }

        /* Sub-Agent Status - NetworkMapper */
        .sub-agent-status {
            background: linear-gradient(135deg, rgba(0, 204, 255, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            border: 1px solid rgba(0, 204, 255, 0.3);
            border-radius: 12px;
            padding: 15px 20px !important;
            margin-bottom: 25px !important;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            backdrop-filter: blur(15px);
            min-height: 90px !important;
            max-height: 90px !important;
        }

        .sub-agent-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .sub-agent-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(0, 204, 255, 0.3);
            flex-shrink: 0;
        }

        .sub-agent-details h3 {
            font-size: 18px;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .sub-agent-details p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .sub-agent-metrics {
            display: flex;
            gap: 30px;
            flex-shrink: 0;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 24px !important;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 3px;
        }

        .metric-label {
            font-size: 12px !important;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* NEW: Encryption Gap Alert */
        .encryption-gap-alert {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.15) 0%, rgba(255, 68, 68, 0.1) 100%);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
            justify-content: space-between;
            align-items: center;
            animation: alertPulse 3s ease-in-out infinite;
            backdrop-filter: blur(15px);
        }

        .encryption-gap-alert.active {
            display: flex;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 170, 0, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 170, 0, 0.6); }
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--warning);
            margin-bottom: 8px;
        }

        .alert-description {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .alert-button {
            background: var(--gradient-1);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: var(--bg-darker);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .alert-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        /* Enhanced Environment Detection */
        .environment-detection {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
            text-align: center;
        }

        .detection-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detection-description {
            color: var(--text-secondary);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 35px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Auto-Scan Section */
        .auto-scan-section {
            margin-bottom: 40px;
        }

        .auto-scan-btn {
            background: var(--gradient-1);
            border: none;
            border-radius: 20px;
            padding: 20px 40px;
            color: var(--bg-darker);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 0 auto;
            min-width: 280px;
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }

        .auto-scan-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 255, 136, 0.4);
        }

        .auto-scan-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .scan-icon {
            font-size: 24px;
        }

        .scan-text {
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .scan-subtitle {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Scan Progress */
        .scan-progress {
            margin-top: 20px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: var(--gradient-1);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-style: italic;
        }

        /* IP Range Manager */
        .ip-range-manager {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: none;
        }

        .ip-range-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .ip-range-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ip-range-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .add-range-btn {
            background: var(--gradient-datacenter);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
        }

        .add-range-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        .add-range-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .reset-config-btn {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.1) 0%, rgba(0, 204, 255, 0.05) 100%);
            border: 2px solid rgba(255, 170, 0, 0.4);
            border-radius: 20px;
            padding: 10px 20px;
            color: var(--warning);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .reset-config-btn:hover {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.2) 0%, rgba(0, 204, 255, 0.1) 100%);
            border-color: var(--warning);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 170, 0, 0.3);
        }

        .reset-config-btn .icon {
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .reset-config-btn:hover .icon {
            transform: rotate(180deg);
        }

        /* IP Ranges Grid */
        .ip-ranges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        /* Interactive Dashboard */
        .dashboard-interactive {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: none;
        }

        .interactive-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .interactive-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Dual Layer Scanning - NEW FROM HYBRID DEMO */
        .scanning-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .scan-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            position: relative;
        }

        .scan-panel.external {
            border-color: rgba(255, 0, 68, 0.3);
        }

        .scan-panel.internal {
            border-color: rgba(0, 255, 136, 0.3);
        }

        .scan-panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .panel-title.external {
            background: var(--gradient-external);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .panel-title.internal {
            background: var(--gradient-internal);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .scan-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .scan-status.active {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .scan-status.needs-setup {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .scan-results {
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 204, 255, 0.05) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .result-value {
            font-size: 13px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .service-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .service-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .service-item:hover {
            background: rgba(0, 255, 136, 0.05);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .service-info {
            flex: 1;
        }

        .service-name {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .service-details {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .service-encryption {
            font-size: 11px;
            color: var(--primary);
        }

        .service-status {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-secure {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
        }

        .status-update {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
        }

        .status-vulnerable {
            background: rgba(255, 0, 68, 0.2);
            color: var(--danger);
        }

        /* NEW: Shodan API Setup Overlay */
        .shodan-api-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 20, 40, 0.95);
            border-radius: 15px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .shodan-api-overlay.active {
            display: flex;
        }

        .shodan-setup-content {
            max-width: 350px;
            width: 100%;
        }

        .shodan-logo {
            font-size: 48px;
            margin-bottom: 20px;
            background: var(--gradient-external);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .shodan-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .shodan-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .shodan-input-group {
            margin-bottom: 20px;
        }

        .shodan-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        .shodan-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(0, 255, 136, 0.05);
        }

        .shodan-input::placeholder {
            color: var(--text-secondary);
            font-family: inherit;
        }

        .shodan-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .shodan-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
        }

        .shodan-btn-primary {
            background: var(--gradient-1);
            color: var(--bg-darker);
        }

        .shodan-btn-secondary {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-secondary);
        }

        .shodan-btn-demo {
            background: var(--gradient-external);
            color: white;
        }

        .shodan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .shodan-link {
            display: inline-block;
            margin-top: 15px;
            color: var(--secondary);
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s ease;
        }

        .shodan-link:hover {
            color: var(--primary);
        }

        /* Network Overview */
        .network-overview {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: none;
        }

        .overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .overview-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .overview-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            background: rgba(0, 255, 136, 0.05);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
        }

        .overview-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .overview-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .overview-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Device Discovery */
        .device-discovery {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: none;
        }

        .discovery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .discovery-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .device-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: deviceSlideIn 0.5s ease;
        }

        .device-card:hover {
            background: rgba(0, 255, 136, 0.05);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
        }

        .device-card.new-device {
            border-color: var(--secondary);
            animation: newDeviceGlow 2s ease-in-out;
        }

        @keyframes deviceSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes newDeviceGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 204, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 204, 255, 0.6); }
        }

        .device-header {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .device-icon {
            font-size: 32px;
        }

        .device-name {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            text-align: center;
        }

        .device-ip {
            font-size: 12px;
            color: var(--secondary);
            margin-bottom: 10px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .device-services {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .device-ai-status {
            font-size: 11px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .device-encryption {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Activity Feed - Using shared.js infrastructure */
        .activity-feed {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            height: 500px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .feed-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--danger);
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: livePulse 2s ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        .feed-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .feed-item {
            background: rgba(0, 255, 136, 0.05);
            border-left: 3px solid var(--primary);
            padding: 15px 20px;
            margin-bottom: 12px;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
            animation: feedSlide 0.3s ease;
        }

        @keyframes feedSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .feed-item:hover {
            background: rgba(0, 255, 136, 0.1);
            transform: translateX(5px);
        }

        .feed-item.warning {
            background: rgba(255, 170, 0, 0.05);
            border-left-color: var(--warning);
        }

        .feed-item.danger {
            background: rgba(255, 0, 68, 0.05);
            border-left-color: var(--danger);
        }

        .feed-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .feed-message {
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 5px;
        }

        .feed-agent {
            font-size: 11px;
            color: var(--accent);
            font-style: italic;
        }

        /* Checkout Section - NEW */
        .checkout-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: none;
            text-align: center;
        }

        .checkout-header {
            margin-bottom: 30px;
        }

        .checkout-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .checkout-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .pricing-summary {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .pricing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pricing-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: var(--primary);
        }

        .pricing-label {
            color: var(--text-secondary);
        }

        .pricing-value {
            color: var(--text-primary);
            font-weight: bold;
        }

        .checkout-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .checkout-btn {
            background: var(--gradient-1);
            border: none;
            border-radius: 12px;
            padding: 15px 40px;
            color: var(--bg-darker);
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }

        .security-note {
            margin-top: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* IP Range Card Styling */
        .ip-range-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(15px);
        }

        .ip-range-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
            border-color: var(--primary);
        }

        .range-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .range-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .range-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-warning {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .range-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .range-metrics {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }

        .range-metric {
            text-align: center;
            flex: 1;
        }

        .range-metric-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .range-metric-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .modal-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-btn-primary {
            background: var(--gradient-1);
            color: var(--bg-darker);
        }

        .modal-btn-secondary {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-secondary);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        /* Modal Input Styles */
        .modal-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            margin-top: 8px;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(0, 255, 136, 0.05);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Streamlined Footer for Secondary Pages */
        .footer-streamlined {
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            border-radius: 20px 20px 0 0;
            padding: 30px;
            margin-top: 40px;
            backdrop-filter: blur(15px);
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .footer-streamlined::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.02), transparent);
            animation: footerScan 12s linear infinite;
        }

        @keyframes footerScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .footer-streamlined-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .footer-logo {
            width: 50px;
            height: 50px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-shield {
            width: 35px;
            height: 35px;
            background: var(--gradient-shield);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            position: relative;
            animation: footerShieldPulse 4s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes footerShieldPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .footer-eye {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--bg-darker);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-iris {
            width: 12px;
            height: 12px;
            background: var(--gradient-1);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0, 255, 136, 0.6);
        }

        .footer-brand-info {
            display: flex;
            flex-direction: column;
        }

        .footer-brand-name {
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 1px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .footer-brand-tagline {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }

        .footer-links {
            display: flex;
            gap: 25px;
            align-items: center;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid transparent;
        }

        .footer-link:hover {
            color: var(--primary);
            background: rgba(0, 255, 136, 0.05);
            border-color: rgba(0, 255, 136, 0.2);
            transform: translateY(-1px);
        }

        .footer-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--success);
            font-weight: 500;
        }

        /* Rotating dots for footer logo */
        .footer-rotating-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 12s linear infinite;
        }

        .footer-dot {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 4px var(--primary);
        }

        .footer-dot:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); }
        .footer-dot:nth-child(2) { top: 50%; right: 0; transform: translateY(-50%); }
        .footer-dot:nth-child(3) { bottom: 0; left: 50%; transform: translateX(-50%); }

        .footer-bottom-streamlined {
            position: relative;
            z-index: 1;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .footer-copyright-streamlined {
            color: var(--text-secondary);
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* AI Chat Widget */
        .ai-chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .ai-chat-toggle {
            width: 60px;
            height: 60px;
            background: var(--gradient-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            transition: all 0.3s ease;
            font-size: 28px;
            border: none;
            color: var(--bg-darker);
        }

        .ai-chat-toggle:hover {
            transform: scale(1.1);
        }

        .ai-chat-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 400px;
            height: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .ai-chat-window.active {
            display: flex;
            animation: chatSlideIn 0.3s ease;
        }

        @keyframes chatSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-chat-header {
            background: var(--gradient-1);
            color: var(--bg-darker);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .ai-chat-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .chat-status-dot {
            width: 8px;
            height: 8px;
            background: var(--bg-darker);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .ai-chat-close {
            cursor: pointer;
            font-size: 24px;
            background: none;
            border: none;
            color: var(--bg-darker);
        }

        .cli-mode-indicator {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 12px;
            color: var(--warning);
            display: none;
            flex-shrink: 0;
        }

        .cli-mode-indicator.active {
            display: block;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            display: flex;
            flex-direction: column;
        }

        .ai-message-bubble {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 15px 20px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .ai-message-bubble.user {
            background: rgba(0, 204, 255, 0.1);
            border-color: var(--secondary);
            align-self: flex-end;
        }

        .ai-message-bubble.system {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--accent);
            font-size: 13px;
            font-style: italic;
        }

        .ai-message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .ai-chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-shrink: 0;
        }

        .ai-chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .ai-chat-input::placeholder {
            color: var(--text-secondary);
        }

        .ai-chat-send {
            background: var(--gradient-1);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: var(--bg-darker);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .scanning-sections {
                grid-template-columns: 1fr;
            }
            
            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .device-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-window {
                width: calc(100vw - 40px);
                height: calc(100vh - 140px);
                right: -20px;
                bottom: 80px;
            }
            
            .ip-range-controls {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }
            
            .reset-config-btn,
            .add-range-btn {
                width: 100%;
                justify-content: center;
            }
            
            .range-info {
                grid-template-columns: 1fr;
            }
            
            .range-metrics {
                flex-direction: column;
                gap: 10px;
            }

            .sub-agent-metrics {
                flex-direction: column;
                gap: 15px;
            }

            .sub-agent-status {
                flex-direction: column;
                text-align: center;
                min-height: auto !important;
                max-height: none !important;
            }

            .encryption-gap-alert {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .footer-streamlined-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .footer-links {
                justify-content: center;
                gap: 15px;
            }

            .footer-status {
                align-items: center;
            }

            .footer-copyright-streamlined {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <script>
        // Check authentication
        const auth = localStorage.getItem('sentinel_auth');
        if (!auth) {
            window.location.href = 'index.html';
        } else {
            const authData = JSON.parse(auth);
            if (Date.now() - authData.timestamp > 24 * 60 * 60 * 1000) {
                localStorage.removeItem('sentinel_auth');
                window.location.href = 'index.html';
            }
        }
    </script>

    <!-- Neural Network Background -->
    <canvas id="neuralCanvas"></canvas>

    <!-- Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-container">
                        <div class="rotating-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <div class="logo-shield">
                            <div class="logo-eye">
                                <div class="logo-iris"></div>
                            </div>
                        </div>
                    </div>
                    <div class="brand-info">
                        <h1 class="brand-name">AI SENTINEL-X</h1>
                        <p class="brand-tagline">Autonomous Cyber Defense</p>
                    </div>
                </div>
                <div class="header-right">
                    <!-- Adaptive Scale Indicator -->
                    <div class="scale-indicator scale-individual" id="scaleIndicator">
                        <span id="scaleIcon">🔍</span>
                        <span id="scaleText">DETECTING</span>
                    </div>
                    
                    <!-- Updated Encryption Badge -->
                    <div class="encryption-badges">
                        <div class="encryption-badge" onclick="showEncryptionStatus()">
                            <div class="status-light"></div>
                            <span>HYBRID MODE ACTIVE</span>
                        </div>
                    </div>
                    
                    <div class="agent-status" onclick="showAgentShutdownModal()">
                        <span class="agent-icon">🤖</span>
                        <div class="agent-info">
                            <span class="agent-title">AI Agent Active</span>
                            <span class="agent-status-text" id="agentModeText">Adaptive Configuration</span>
                        </div>
                    </div>
                    
                    <button class="logout-btn" onclick="handleLogout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="dashboard.html" class="nav-tab">
                <span>🏠</span>
                <span>Dashboard</span>
            </a>
            <a href="threats.html" class="nav-tab">
                <span>🛡️</span>
                <span>Threats</span>
            </a>
            <a href="#" class="nav-tab active">
                <span>🌐</span>
                <span>Network</span>
            </a>
            <a href="defense.html" class="nav-tab">
                <span>⚔️</span>
                <span>Defense</span>
            </a>
            <a href="ai-engine.html" class="nav-tab">
                <span>🧠</span>
                <span>AI Engine</span>
            </a>
            <a href="encryption.html" class="nav-tab">
                <span>🔐</span>
                <span>Encryption</span>
            </a>
            <a href="analytics.html" class="nav-tab">
                <span>📊</span>
                <span>Analytics</span>
            </a>
            <a href="vpn.html" class="nav-tab">
                <span>🔒</span>
                <span>VPNMonitor</span>
            </a>
            <a href="settings.html" class="nav-tab">
                <span>⚙️</span>
                <span>Settings</span>
            </a>
        </nav>

        <!-- Sub-Agent Status Banner - VISIBLE ON LANDING -->
        <div class="sub-agent-status" id="subAgentStatus">
            <div class="sub-agent-info">
                <div class="sub-agent-icon">🌐</div>
                <div class="sub-agent-details">
                    <h3 id="subAgentTitle">NetworkMapper Sub-Agent</h3>
                    <p id="subAgentDescription">Adaptive network discovery • Scale detection • Reports to Main Agent</p>
                </div>
            </div>
            <div class="sub-agent-metrics">
                <div class="metric">
                    <div class="metric-value" id="totalNetworks">-</div>
                    <div class="metric-label" id="networksLabel">Scanning</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="discoveredDevices">-</div>
                    <div class="metric-label">Detecting</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="openServices">-</div>
                    <div class="metric-label">Services</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="newDevices">-</div>
                    <div class="metric-label">New (24h)</div>
                </div>
            </div>
        </div>

        <!-- NEW: Encryption Gap Alert (Hidden by default) -->
        <div class="encryption-gap-alert" id="encryptionGapAlert">
            <div class="alert-content">
                <div class="alert-title">⚠️ Encryption Gaps Detected</div>
                <div class="alert-description" id="gapDescription">3 devices are not encrypted and require immediate attention.</div>
            </div>
            <button class="alert-button" onclick="remediateEncryptionGaps()">Remediate Now</button>
        </div>

        <!-- Environment Detection with Auto-Scan -->
        <div class="environment-detection" id="environmentDetection">
            <div class="detection-title">🎯 Comprehensive Network Discovery</div>
            <div class="detection-description">
                AI Sentinel-X performs internal network discovery first to identify your endpoints and determine the optimal security package. Once your infrastructure is mapped, you can add external reconnaissance capabilities via Shodan API for complete visibility.
            </div>
            
            <div class="auto-scan-section">
                <button class="auto-scan-btn" onclick="startAutoScan()" id="autoScanBtn">
                    <span class="scan-icon">🔍</span>
                    <span class="scan-text">Start Internal Discovery</span>
                   <span class="scan-subtitle">Map Internal Infrastructure First</span>
               </button>
               <div class="scan-progress" id="scanProgress" style="display: none;">
                   <div class="progress-bar">
                       <div class="progress-fill" id="progressFill"></div>
                   </div>
                   <div class="progress-text" id="progressText">Initializing internal scan...</div>
               </div>
           </div>
       </div>

       <!-- IP Range Manager (Hidden until configured) -->
       <div class="ip-range-manager" id="ipRangeManager" style="display: none;">
           <div class="ip-range-header">
               <h2 class="ip-range-title" id="ipRangeTitle">Network Range Management</h2>
               <div class="ip-range-controls">
                   <button class="add-range-btn" onclick="showAddRangeModal()" id="addRangeBtn">Add IP Range</button>
                   <button class="reset-config-btn" onclick="showRescanModal()" title="Reset network discovery and reconfigure environment">
                       <span class="icon">🔄</span>
                       <span>Reset Configuration</span>
                   </button>
               </div>
           </div>
           
           <div class="ip-ranges-grid" id="ipRangesGrid">
               <!-- IP ranges will be populated here -->
           </div>
       </div>

       <!-- Interactive Dashboard Section -->
       <div class="dashboard-interactive" id="dashboardInteractive" style="display: none;">
           <div class="interactive-header">
               <h2 class="interactive-title" id="interactiveTitle">Network Discovery Dashboard</h2>
               <div class="auto-scan-controls">
                   <span style="color: var(--text-secondary); font-size: 14px;" id="scanDetails">Continuous Monitoring Active</span>
                   <button class="reset-config-btn" onclick="showRescanModal()" title="Reset network discovery and reconfigure environment">
                       <span class="icon">🔄</span>
                       <span>Reset Configuration</span>
                   </button>
               </div>
           </div>
           <p style="color: var(--text-secondary); text-align: center; font-size: 14px; line-height: 1.6;" id="dashboardDescription">
               🤖 <strong>Autonomous scanning active</strong> • Hybrid-resistant encryption • No manual intervention required
           </p>
       </div>

       <!-- Dual Layer Scanning Sections -->
       <div class="scanning-sections" id="scanningSections" style="display: none;">
           <!-- External Scan Panel -->
           <div class="scan-panel external">
               <div class="panel-header">
                   <h2 class="panel-title external">External Scan (Shodan)</h2>
                   <div class="scan-status needs-setup" id="externalScanStatus">
                       <div class="status-dot"></div>
                       <span>SETUP REQUIRED</span>
                   </div>
               </div>
               
               <!-- Shodan API Setup Overlay -->
               <div class="shodan-api-overlay active" id="shodanApiOverlay">
                   <div class="shodan-setup-content">
                       <div class="shodan-logo">🔍</div>
                       <div class="shodan-title">Shodan API Setup</div>
                       <div class="shodan-description">
                           Add your Shodan API key to enable external reconnaissance and public exposure analysis of your infrastructure.
                       </div>
                       
                       <div class="shodan-input-group">
                           <input 
                               type="text" 
                               class="shodan-input" 
                               id="shodanApiKey" 
                               placeholder="Enter Shodan API Key"
                           >
                       </div>
                       
                       <div class="shodan-actions">
                           <button class="shodan-btn shodan-btn-primary" onclick="setupShodanApi()">Connect</button>
                           <button class="shodan-btn shodan-btn-secondary" onclick="skipShodanSetup()">Skip</button>
                       </div>
                       
                       <a href="https://www.shodan.io/" target="_blank" class="shodan-link">
                           Get Shodan API Key →
                       </a>
                   </div>
               </div>
               
               <div class="scan-results">
                   <div class="result-item">
                       <span class="result-label">Organization</span>
                       <span class="result-value" id="orgName">Pending API Setup</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">ISP</span>
                       <span class="result-value" id="ispName">-</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">Location</span>
                       <span class="result-value" id="location">-</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">Open Ports</span>
                       <span class="result-value" id="openPorts" style="color: var(--warning);">-</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">Vulnerabilities</span>
                       <span class="result-value" id="vulnCount" style="color: var(--danger);">-</span>
                   </div>
               </div>

               <div class="service-list" id="externalServicesList">
                   <!-- External services will be populated here after API setup -->
               </div>
           </div>

           <!-- Internal Scan Panel -->
           <div class="scan-panel internal">
               <div class="panel-header">
                   <h2 class="panel-title internal">Internal Scan (Agent)</h2>
                   <div class="scan-status active">
                       <div class="status-dot"></div>
                       <span>AUTO-DISCOVERING</span>
                   </div>
               </div>
               
               <div class="scan-results">
                   <div class="result-item">
                       <span class="result-label">Network Range</span>
                       <span class="result-value" id="networkRange">192.168.1.0/24</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">Active Hosts</span>
                       <span class="result-value" id="activeHosts" style="color: var(--success);">246</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">New Devices (24h)</span>
                       <span class="result-value" id="newDevicesInternal" style="color: var(--secondary);">14</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">Unpatched Systems</span>
                       <span class="result-value" id="unpatchedSystems" style="color: var(--warning);">18</span>
                   </div>
                   <div class="result-item">
                       <span class="result-label">AI Monitoring</span>
                       <span class="result-value" style="color: var(--accent);">REAL-TIME</span>
                   </div>
               </div>

               <div class="service-list" id="internalServicesList">
                   <!-- Internal services will be populated here -->
               </div>
           </div>
       </div>

       <!-- Network Overview -->
       <div class="network-overview" id="networkOverview" style="display: none;">
           <div class="overview-header">
               <h2 class="overview-title" id="overviewTitle">Network Overview</h2>
           </div>
           <div class="overview-grid" id="overviewGrid">
               <!-- Overview cards will be populated here -->
           </div>
       </div>

       <!-- Device Discovery -->
       <div class="device-discovery" id="deviceDiscovery" style="display: none;">
           <div class="discovery-header">
               <h2 class="discovery-title" id="discoveryTitle">Device Discovery</h2>
           </div>
           <div class="device-grid" id="deviceGrid">
               <!-- Device cards will be populated here -->
           </div>
       </div>

       <!-- Network Activity Feed -->
       <div class="activity-feed" id="networkActivityFeed" style="display: none;">
           <div class="feed-header">
               <h2 class="feed-title">
                   <span>🌐</span>
                   <span>Network Activity Feed</span>
               </h2>
               <div class="live-indicator">
                   <div class="live-dot"></div>
                   <span>LIVE</span>
               </div>
           </div>
           <div class="feed-content" id="networkActivityFeedContent">
               <!-- Feed items will be populated by ActivityFeedManager -->
           </div>
       </div>

       <!-- Checkout Section -->
       <div class="checkout-section" id="checkoutSection" style="display: none;">
           <div class="checkout-header">
               <h2 class="checkout-title">Complete Your Security Setup</h2>
               <p class="checkout-subtitle">Your network scan is complete. Subscribe to activate AI Sentinel-X protection.</p>
           </div>

           <div class="pricing-summary" id="pricingSummary">
               <!-- Pricing will be populated based on selected package -->
           </div>

           <div class="checkout-form">
               <button class="checkout-btn" onclick="processCheckout()">
                   <span>🔒</span>
                   <span>Secure Checkout with Stripe</span>
               </button>
               <div class="security-note">
                   <span>🛡️</span>
                   <span>256-bit SSL encryption • PCI compliant • Instant activation</span>
               </div>
           </div>
       </div>

   </div>

   <!-- Streamlined Footer for Secondary Pages -->
   <footer class="footer-streamlined">
       <div class="footer-streamlined-content">
           <div class="footer-brand">
               <div class="footer-logo">
                   <div class="footer-rotating-dots">
                       <span class="footer-dot"></span>
                       <span class="footer-dot"></span>
                       <span class="footer-dot"></span>
                   </div>
                   <div class="footer-shield">
                       <div class="footer-eye">
                           <div class="footer-iris"></div>
                       </div>
                   </div>
               </div>
               <div class="footer-brand-info">
                   <h3 class="footer-brand-name">AI Sentinel-X</h3>
                   <p class="footer-brand-tagline">Autonomous Cyber Defense</p>
               </div>
           </div>
           
           <div class="footer-links">
               <a href="dashboard.html" class="footer-link">
                   <span>🏠</span>
                   <span>Dashboard</span>
               </a>
               <a href="mailto:support@ai-sentinel-x.com" class="footer-link">
                   <span>📧</span>
                   <span>Support</span>
               </a>
               <a href="https://docs.ai-sentinel-x.com" target="_blank" class="footer-link">
                   <span>📚</span>
                   <span>Documentation</span>
               </a>
               <a href="settings.html" class="footer-link">
                   <span>⚙️</span>
                   <span>Settings</span>
               </a>
           </div>
           
           <div class="footer-status">
               <div class="status-indicator">
                   <div class="status-dot"></div>
                   <span>All Systems Operational</span>
               </div>
           </div>
       </div>
       
       <div class="footer-bottom-streamlined">
           <div class="footer-copyright-streamlined">
               <span>© 2025 AI Sentinel-X</span>
               <span>•</span>
               <span>NetworkMapper Active</span>
           </div>
       </div>
   </footer>

   <!-- Add Range Modal -->
   <div class="modal-overlay" id="addRangeModal" onclick="closeModalOnOverlay(event)">
       <div class="modal">
           <div class="modal-header">
               <h2 class="modal-title" id="addRangeModalTitle">🌐 Add IP Range</h2>
           </div>
           <div class="modal-content">
               <div class="input-group">
                   <label for="rangeName">Range Name:</label>
                   <input type="text" id="rangeName" placeholder="e.g., Main Office" class="modal-input">
               </div>
               <div class="input-group">
                   <label for="ipRange">IP Range (CIDR):</label>
                   <input type="text" id="ipRange" placeholder="e.g., 192.168.1.0/24" class="modal-input">
               </div>
               <div class="input-group">
                   <label for="location">Location:</label>
                   <input type="text" id="location" placeholder="e.g., New York, US" class="modal-input">
               </div>
               <div class="input-group">
                   <label for="organization">Organization:</label>
                   <input type="text" id="organization" placeholder="e.g., Company ISP" class="modal-input">
               </div>
           </div>
           <div class="modal-actions">
               <button class="modal-btn modal-btn-primary" onclick="addIPRange()">Add Range</button>
               <button class="modal-btn modal-btn-secondary" onclick="closeAddRangeModal()">Cancel</button>
           </div>
       </div>
   </div>

   <!-- Rescan Modal -->
   <div class="modal-overlay" id="rescanModal" onclick="closeModalOnOverlay(event)">
       <div class="modal">
           <div class="modal-header">
               <h2 class="modal-title">🔄 Reset Network Discovery</h2>
           </div>
           <div class="modal-content">
               <p>This will reset the network discovery configuration and return you to the environment detection screen. All current network data will be cleared.</p>
               <p><strong>Warning:</strong> This action cannot be undone. The AI agent will need to reconfigure your environment from scratch.</p>
           </div>
           <div class="modal-actions">
               <button class="modal-btn modal-btn-primary" onclick="confirmRescan()">Reset Configuration</button>
               <button class="modal-btn modal-btn-secondary" onclick="closeRescanModal()">Cancel</button>
           </div>
       </div>
   </div>

   <!-- Agent Shutdown Modal -->
   <div class="modal-overlay" id="agentShutdownModal" onclick="closeModalOnOverlay(event)">
       <div class="modal">
           <div class="modal-header">
               <h2 class="modal-title">⚠️ Agent Control Toggle</h2>
           </div>
           <div class="modal-content">
               Toggle autonomous mode? When paused, manual control remains available through the AI chat bot CLI. System will fallback to local control mode if external APIs are offline.
           </div>
           <div class="modal-actions">
               <button class="modal-btn modal-btn-primary" onclick="confirmAgentShutdown()">Toggle Agent Mode</button>
               <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
           </div>
       </div>
   </div>

   <!-- AI Chat Widget -->
   <div class="ai-chat-widget">
       <div class="ai-chat-window" id="aiChatWindow">
           <div class="ai-chat-header">
               <div class="ai-chat-status">
                   <span class="chat-status-dot"></span>
                   <span>NETWORKMAPPER ONLINE</span>
               </div>
               <button class="ai-chat-close" onclick="toggleChat()">×</button>
           </div>
           <div class="cli-mode-indicator" id="cliModeIndicator">
               ⚠️ CLI MODE - NetworkMapper Offline
           </div>
           <div class="ai-chat-messages" id="aiChatMessages">
               <div class="ai-message">
                   <div class="ai-message-bubble">
                       Welcome to AI Sentinel-X V4 Network Discovery. I'm NetworkMapper, coordinating with ThreatScanner, EncryptionDeployer, and other sub-agents. I perform internal discovery first to map your infrastructure, then you can add external reconnaissance via Shodan API for complete visibility.
                   </div>
                   <div class="ai-message-time">Just now</div>
               </div>
           </div>
           <div class="ai-chat-input-container">
               <input 
                   type="text" 
                   class="ai-chat-input" 
                   id="aiChatInput" 
                   placeholder="Ask about network discovery, encryption gaps, or security configuration..."
                   onkeypress="handleChatKeyPress(event)"
               >
               <button class="ai-chat-send" id="aiChatSend" onclick="sendChatMessage()">SEND</button>
           </div>
       </div>
       <button class="ai-chat-toggle" onclick="toggleChat()">🤖</button>
   </div>

   <script src="shared.js"></script>
   <script src="network-core.js"></script>
   <script>
       // Network page-specific configurations using shared.js infrastructure
       let networkFeedId = 'network-feed';

       // Enhanced initialization for V4
       document.addEventListener('DOMContentLoaded', () => {
           console.log('Network V4 module loaded');
           setTimeout(() => {
               initializeNetworkPage();
           }, 100);
       });

       function initializeNetworkPage() {
           // Initialize neural background from shared.js
           if (typeof initNeuralBackground === 'function') {
               initNeuralBackground();
           }

           // Initialize page context from shared.js
           if (typeof initializePageContext === 'function') {
               initializePageContext();
           }

           // Initialize chat system from shared.js
           if (typeof SentinelChat !== 'undefined') {
               window.sentinelChat = new SentinelChat();
           }

           // Initialize encryption status click handler
           window.showEncryptionStatus = function() {
               if (window.sentinelChat && !SentinelState.chatOpen) {
                   window.sentinelChat.toggle();
               }
               setTimeout(() => {
                   if (window.sentinelChat) {
                       window.sentinelChat.addMessage('NetworkMapper: Hybrid encryption active across all discovered devices. Classical algorithms (AES-256-GCM, ChaCha20-Poly1305) combined with post-quantum (Kyber-1024, Dilithium-3, SPHINCS+). Coordinating with EncryptionManager for comprehensive protection.', false);
                   }
               }, 300);
           };

           // Initialize V4 features
           initializeV4Features();
           
           // Initialize environment detection if needed
           if (typeof initializeEnvironmentDetection === 'function') {
               initializeEnvironmentDetection();
           }
           
           // Auto-update metrics periodically
           setInterval(() => {
               if (window.currentScale) {
                   updateMetrics();
                   checkEncryptionGaps();
               }
           }, 8000);
       }

       function initializeV4Features() {
           // Enhanced dual-layer scanning data
           window.externalServices = [
               {
                   name: 'HTTPS (443/tcp)',
                   details: 'nginx/1.18.0 • TLS 1.3',
                   encryption: '🔐 AES-256-GCM + CRYSTALS-Kyber',
                   status: 'Secure',
                   statusClass: 'status-secure'
               },
               {
                   name: 'SSH (22/tcp)',
                   details: 'OpenSSH_7.4 • Key Auth Only',
                   encryption: '🔐 Hybrid: Classical + PQ Keys',
                   status: 'Secure',
                   statusClass: 'status-secure'
               },
               {
                   name: 'RDP (3389/tcp)',
                   details: 'Windows Server 2019 • NLA + TLS 1.2',
                   encryption: '⚠️ Classical only - upgrade needed',
                   status: 'Monitor',
                   statusClass: 'status-update'
               },
               {
                   name: 'SMB (445/tcp)',
                   details: 'SMBv2 • Outdated',
                   encryption: '❌ Weak encryption',
                   status: 'Vulnerable',
                   statusClass: 'status-vulnerable'
               }
           ];

           window.internalServices = [
               {
                   name: 'Domain Controllers',
                   details: '2 servers • AD DS • Kerberos',
                   encryption: '🔐 Full hybrid encryption',
                   status: 'Secure',
                   statusClass: 'status-secure'
               },
               {
                   name: 'Database Servers',
                   details: '5 instances • TDE enabled',
                   encryption: '🔐 AES-256 + Kyber-1024',
                   status: 'Secure',
                   statusClass: 'status-secure'
               },
               {
                   name: 'IoT Devices',
                   details: '47 devices • Mixed security',
                   encryption: '⚠️ Partial encryption support',
                   status: 'Monitor',
                   statusClass: 'status-update'
               },
               {
                   name: 'Workstations',
                   details: '189 systems • BitLocker enabled',
                   encryption: '🔐 Hybrid disk encryption',
                   status: 'Update',
                   statusClass: 'status-update'
               }
           ];
       }

       // NEW: Shodan API Setup Functions
       window.setupShodanApi = function() {
           const apiKey = document.getElementById('shodanApiKey').value.trim();
           
           if (!apiKey) {
               alert('Please enter a Shodan API key');
               return;
           }
           
           // Store API key (in demo mode)
           localStorage.setItem('shodan_api_key', apiKey);
           
           // Hide overlay and update external panel
           const overlay = document.getElementById('shodanApiOverlay');
           const status = document.getElementById('externalScanStatus');
           
           if (overlay) overlay.classList.remove('active');
           if (status) {
               status.innerHTML = '<div class="status-dot"></div><span>SCANNING</span>';
               status.className = 'scan-status active';
           }
           
           // Populate external scan results
           populateExternalScanResults();
           
           // Add chat message
           if (window.sentinelChat && SentinelState.chatOpen) {
               sentinelChat.addMessage('🔍 NetworkMapper: Shodan API connected successfully! External reconnaissance now active. Scanning public infrastructure...', false, 'system');
           }
       };

       window.useDemoShodan = function() {
           // Set demo API key
           localStorage.setItem('shodan_api_key', 'demo-key-' + Math.random().toString(36).substr(2, 8));
           
           // Hide overlay and update external panel
           const overlay = document.getElementById('shodanApiOverlay');
           const status = document.getElementById('externalScanStatus');
           
           if (overlay) overlay.classList.remove('active');
           if (status) {
               status.innerHTML = '<div class="status-dot"></div><span>DEMO MODE</span>';
               status.className = 'scan-status active';
           }
           
           // Populate demo external scan results
           populateExternalScanResults();
           
           // Add chat message
           if (window.sentinelChat && SentinelState.chatOpen) {
               sentinelChat.addMessage('🔍 NetworkMapper: Demo Shodan mode activated! Simulating external reconnaissance with sample data.', false, 'system');
           }
       };

       window.skipShodanSetup = function() {
           // Hide overlay but keep status as setup required
           const overlay = document.getElementById('shodanApiOverlay');
           if (overlay) overlay.classList.remove('active');
           
           // Add chat message
           if (window.sentinelChat && SentinelState.chatOpen) {
               sentinelChat.addMessage('NetworkMapper: Shodan setup skipped. External reconnaissance disabled. You can add your API key later in Settings.', false, 'system');
           }
       };

       function populateExternalScanResults() {
           // Update result values
           document.getElementById('orgName').textContent = 'Acme Corporation';
           document.getElementById('ispName').textContent = 'Business Fiber Network';
           document.getElementById('location').textContent = 'Columbia, SC, US';
           document.getElementById('openPorts').textContent = '7';
           document.getElementById('vulnCount').textContent = '2';
           
           // Populate external services list
           populateExternalServices();
       }

       function populateExternalServices() {
           const externalList = document.getElementById('externalServicesList');
           if (externalList && window.externalServices) {
               externalList.innerHTML = '';
               window.externalServices.forEach(service => {
                   const item = createServiceItem(service);
                   externalList.appendChild(item);
               });
           }
       }

       // Setup activity feed when scale is selected
       function setupNetworkActivityFeed() {
           const feedContainer = document.getElementById('networkActivityFeed');
           if (feedContainer && window.currentScale) {
               feedContainer.style.display = 'flex';
               
               // Initialize network activity feed using shared.js ActivityFeedManager
               if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                   activityFeedManager.initializeFeed(networkFeedId, 'network');
                   activityFeedManager.setFeedContainer(networkFeedId, 'networkActivityFeedContent');
                   
                   // Add initial messages based on scale
                   if (window.currentScale === 'individual') {
                       activityFeedManager.addMessage(networkFeedId, '🔍 NetworkMapper: Internal scan complete - 1 server discovered', '', 'NetworkMapper');
                       activityFeedManager.addMessage(networkFeedId, '✅ ThreatScanner: No critical vulnerabilities on internal network', '', 'NetworkMapper → ThreatScanner');
                       activityFeedManager.addMessage(networkFeedId, '🔐 EncryptionDeployer: Hybrid encryption verified on primary server', 'encryption', 'NetworkMapper → EncryptionDeployer');
                   } else if (window.currentScale === 'business') {
                       activityFeedManager.addMessage(networkFeedId, '🏢 NetworkMapper: Multi-site internal scan complete - 3 locations', '', 'NetworkMapper');
                       activityFeedManager.addMessage(networkFeedId, '🔍 Internal discovery: 127 devices mapped across all sites', '', 'NetworkMapper');
                       activityFeedManager.addMessage(networkFeedId, '⚠️ ThreatScanner: 2 medium-risk vulnerabilities detected', 'warning', 'NetworkMapper → ThreatScanner');
                   } else if (window.currentScale === 'enterprise') {
                       activityFeedManager.addMessage(networkFeedId, '🏭 NetworkMapper: Enterprise internal scan across 3 data centers', '', 'NetworkMapper');
                       activityFeedManager.addMessage(networkFeedId, '🔍 Internal discovery: 1,926 devices across global infrastructure', '', 'NetworkMapper');
                       activityFeedManager.addMessage(networkFeedId, '🛡️ ThreatScanner: Advanced persistent threat indicators analyzed', '', 'NetworkMapper → ThreatScanner');
                   }
                   
                   // Start auto-generation for network feed
                   activityFeedManager.startAutoGeneration(networkFeedId, 5000);
               }
           }
       }

       // Override remediateEncryptionGaps to open chat
       window.remediateEncryptionGaps = function() {
           if (!window.sentinelChat) {
               console.error('Chat system not available');
               return;
           }

           // Open chat if not already open
           if (!SentinelState.chatOpen) {
               sentinelChat.toggle();
           }

           setTimeout(() => {
               sentinelChat.addMessage('remediate encryption gaps', true);
               
               setTimeout(() => {
                   sentinelChat.addMessage('NetworkMapper: Initiating encryption gap remediation. Coordinating with EncryptionDeployer and CertificateManager...', false, 'system');
               }, 500);
               
               setTimeout(() => {
                   sentinelChat.addMessage(`EncryptionDeployer: Analyzing unencrypted devices. Deploying hybrid-resistant encryption modules. Working with CertificateManager for key distribution.`, false);
               }, 1200);
               
               setTimeout(() => {
                   sentinelChat.addMessage('EncryptionDeployer: Deployment in progress. Using TLS 1.3 + Kyber-1024 for network traffic, AES-256-GCM + Dilithium-3 for data at rest.', false);
               }, 2500);
               
               // Simulate completion
               setTimeout(() => {
                   sentinelChat.addMessage(`✅ EncryptionDeployer: Remediation complete! All devices now protected with hybrid-resistant encryption. NetworkMapper verified. No gaps detected.`, false);
                   
                   // Hide the alert
                   hideEncryptionGapAlert();
               }, 4000);
               
           }, 300);
       };

       // Cleanup activity feed on page unload
       window.addEventListener('beforeunload', () => {
           if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
               activityFeedManager.stopAutoGeneration(networkFeedId);
           }
       });

       // Global functions for compatibility - leveraging shared chat system
       window.toggleChat = () => {
           if (window.sentinelChat) {
               window.sentinelChat.toggle();
           }
       };
       
       window.sendChatMessage = () => {
           const input = document.getElementById('aiChatInput');
           if (input && input.value.trim() && window.sentinelChat) {
               window.sentinelChat.sendMessage(input.value.trim());
               input.value = '';
           }
       };
       
       window.handleChatKeyPress = (e) => {
           if (e.key === 'Enter') {
               sendChatMessage();
           }
       };
       
       window.showAgentShutdownModal = () => {
           const modal = document.getElementById('agentShutdownModal');
           if (modal) modal.style.display = 'flex';
       };
       
       window.closeModal = () => {
           const modal = document.getElementById('agentShutdownModal');
           if (modal) modal.style.display = 'none';
       };
       
       window.closeModalOnOverlay = (e) => {
           if (e.target.classList.contains('modal-overlay')) {
               const modalId = e.target.id;
               if (modalId === 'addRangeModal') {
                   closeAddRangeModal();
               } else if (modalId === 'rescanModal') {
                   closeRescanModal();
               } else if (modalId === 'agentShutdownModal') {
                   closeModal();
               }
           }
       };
       
       window.confirmAgentShutdown = () => {
           if (typeof SentinelState !== 'undefined') {
               SentinelState.agentActive = !SentinelState.agentActive;
               
               // Update UI elements
               const agentStatus = document.querySelector('.agent-status');
               const agentTitle = document.querySelector('.agent-title');
               const agentStatusText = document.querySelector('.agent-status-text');
               const cliIndicator = document.getElementById('cliModeIndicator');
               
               if (SentinelState.agentActive) {
                   if (agentStatus) {
                       agentStatus.style.background = 'rgba(0, 255, 136, 0.1)';
                       agentStatus.style.borderColor = '#00ff88';
                   }
                   if (agentTitle) {
                       agentTitle.textContent = 'AI Agent Active';
                       agentTitle.style.color = 'var(--primary)';
                   }
                   if (agentStatusText) {
                       agentStatusText.textContent = 'Adaptive Configuration';
                   }
                   if (cliIndicator) {
                       cliIndicator.classList.remove('active');
                   }
                   
                   // Resume activity feeds
                   if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                       activityFeedManager.resumeAllFeeds();
                   }
               } else {
                   if (agentStatus) {
                       agentStatus.style.background = 'rgba(255, 170, 0, 0.1)';
                       agentStatus.style.borderColor = '#ffaa00';
                   }
                   if (agentTitle) {
                       agentTitle.textContent = 'AI Agent Paused';
                       agentTitle.style.color = '#ffaa00';
                   }
                   if (agentStatusText) {
                       agentStatusText.textContent = 'Manual Control Only';
                   }
                   if (cliIndicator) {
                       cliIndicator.classList.add('active');
                   }
                   
                   // Pause activity feeds
                   if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                       activityFeedManager.pauseAllFeeds();
                   }
               }
               
               closeModal();
               
               if (SentinelState.chatOpen && window.sentinelChat) {
                   const status = SentinelState.agentActive ? 'resumed autonomous operation' : 'switched to manual control mode';
                   window.sentinelChat.addMessage(`⚠️ Main Agent has ${status}. Network discovery ${SentinelState.agentActive ? 'continuing' : 'paused'}.`, false, 'system');
               }
           }
       };
       
       window.handleLogout = () => {
           if (confirm('Are you sure you want to logout? The AI agent will continue protecting your network autonomously.')) {
               localStorage.removeItem('sentinel_auth');
               localStorage.removeItem('sentinel_scale');
               window.location.href = 'index.html';
           }
       };
   </script>
</body>
</html>
